<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulatore Moto Parabolico</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .simulation-area {
            display: grid;
            grid-template-columns: 1fr 450px;
            gap: 20px;
        }

        .right-column {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .canvas-container {
            background: #f0f4f8;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            height: fit-content;
        }

        canvas {
            display: block;
            width: 100%;
            border-radius: 10px;
            background: linear-gradient(to bottom, #87CEEB 0%, #87CEEB 70%, #8B7355 70%, #8B7355 100%);
            cursor: crosshair;
        }

        .controls {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .control-group {
            margin-bottom: 25px;
        }

        .control-group label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            font-size: 0.95em;
        }

        .value-display {
            float: right;
            color: #667eea;
            font-weight: bold;
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .toggle-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            background: white;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .toggle-label {
            font-weight: 600;
            color: #333;
        }

        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
            background: #ccc;
            border-radius: 15px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .toggle-switch.active {
            background: #667eea;
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            transition: left 0.3s;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .toggle-switch.active::after {
            left: 33px;
        }

        /* Layout controlli a tre colonne */
        .controls-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .margin-top-20 {
            margin-top: 20px;
        }

        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }

        button {
            padding: 12px 20px;
            font-size: 1em;
            font-weight: 600;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .btn-launch {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-launch:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
        }

        .btn-reset {
            background: #ff6b6b;
            color: white;
        }

        .btn-reset:hover {
            background: #ee5a52;
            transform: translateY(-2px);
        }

        .info-panel {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .info-panel h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        .info-item:last-child {
            border-bottom: none;
        }

        .info-label {
            font-weight: 600;
            color: #555;
        }

        .info-value {
            color: #667eea;
            font-weight: bold;
        }

        .legend {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 30px;
            height: 4px;
            border-radius: 2px;
        }

        .legend-text {
            font-size: 0.9em;
            color: #555;
        }

        /* Sezioni controlli organizzate */
        .control-section {
            background: #ffffff;
            padding: 18px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 2px solid #e0e0e0;
        }

        .control-section h4 {
            margin: 0 0 15px 0;
            font-size: 1.1em;
            color: #667eea;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .control-section.highlight {
            border-color: #667eea;
            background: linear-gradient(135deg, #f5f7ff 0%, #ffffff 100%);
        }

        .control-section.warning {
            border-color: #ff9800;
            background: linear-gradient(135deg, #fff9f0 0%, #ffffff 100%);
        }

        .control-section.info {
            border-color: #2196f3;
            background: linear-gradient(135deg, #f0f8ff 0%, #ffffff 100%);
        }

        #advancedModelContainer {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
        }

        #advancedModelContainer>div:first-child {
            display: flex;
            flex-direction: column;
            gap: 5px;
            flex: 1;
        }

        #advancedModelContainer>div:first-child>span:last-child {
            font-size: 0.8em;
            color: #666;
        }

        /* Legend colors */
        .legend-color-1 {
            background: #FF6B35;
        }

        .legend-color-2 {
            background: #004E89;
        }

        .legend-color-3 {
            background: #9D4EDD;
        }

        /* Helper text */
        .helper-text {
            font-size: 0.8em;
            color: #666;
            margin-top: 5px;
        }

        /* Horizontal divider */
        .info-divider {
            margin: 15px 0;
            border: none;
            border-top: 2px solid #eee;
        }

        /* Energy panel */
        .energy-panel {
            background: #fff9c4;
            padding: 12px;
            border-radius: 8px;
            margin-top: 10px;
        }

        .energy-panel h4 {
            color: #f57f17;
            margin-bottom: 8px;
            font-size: 1em;
        }

        .energy-panel .info-item {
            border: none;
            padding: 5px 0;
        }

        .energy-panel .info-text {
            font-size: 0.85em;
            color: #666;
            margin-top: 8px;
            line-height: 1.4;
        }

        /* Didactic panel */
        .didactic-panel {
            margin-top: 20px;
        }

        .didactic-panel p.description {
            margin-bottom: 15px;
            color: #666;
        }

        .btn-explain {
            width: 100%;
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            padding: 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1.1em;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn-explain:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(17, 153, 142, 0.4);
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            animation: fadeIn 0.3s;
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: white;
            border-radius: 15px;
            width: 90%;
            max-width: 1200px;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
            animation: slideIn 0.3s;
        }

        .modal-header {
            padding: 20px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 1.8em;
        }

        .modal-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 2em;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
            line-height: 1;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .modal-body {
            padding: 30px;
            overflow-y: auto;
            flex: 1;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Explanation boxes */
        .explanation-box {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .explanation-box-blue {
            background: #f0f9ff;
            border-left: 4px solid #667eea;
        }

        .explanation-box-orange {
            background: #fff4e6;
            border-left: 4px solid #ff6b35;
        }

        .explanation-box-purple {
            background: #f3e5f5;
            border-left: 4px solid #9D4EDD;
        }

        .explanation-box-yellow {
            background: #fff9c4;
            border-left: 4px solid #f9a825;
        }

        .explanation-box-green {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
        }

        .explanation-box-pink {
            background: #fce4ec;
            border-left: 4px solid #e91e63;
        }

        .explanation-box-lightblue {
            background: #e3f2fd;
            padding: 12px;
            border-radius: 6px;
            margin-top: 12px;
        }

        .explanation-box-lightorange {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
        }

        .explanation-box h4 {
            margin-bottom: 10px;
        }

        .explanation-box-blue h4 {
            color: #667eea;
        }

        .explanation-box-orange h4 {
            color: #d84315;
        }

        .explanation-box-purple h4 {
            color: #6a1b9a;
        }

        .explanation-box-yellow h4 {
            color: #f57f17;
        }

        .explanation-box-green h4 {
            color: #2e7d32;
        }

        .explanation-box-lightorange h4 {
            color: #e65100;
        }

        .explanation-box p {
            margin-bottom: 8px;
        }

        .explanation-box p.margin-top {
            margin-top: 10px;
        }

        .explanation-box p.note {
            font-size: 0.9em;
            color: #666;
        }

        .explanation-box p.italic-note {
            margin-top: 10px;
            font-style: italic;
            color: #6a1b9a;
        }

        .explanation-box ul,
        .explanation-box ol {
            margin-left: 20px;
        }

        .explanation-box ul {
            line-height: 1.8;
        }

        .explanation-box ol {
            line-height: 2;
        }

        .explanation-box-lightblue p {
            margin: 0;
            font-size: 0.95em;
        }

        .explanation-box-lightblue ul {
            margin: 8px 0 0 20px;
            line-height: 1.7;
            font-size: 0.9em;
        }

        .explanation-box-green .content {
            line-height: 2;
        }

        .explanation-box-pink .content p {
            margin-left: 15px;
            margin-bottom: 10px;
        }

        .experiment-step {
            margin-left: 15px;
            margin-bottom: 10px;
        }

        @media (max-width: 1100px) {
            .controls-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Simulatore Moto Parabolico</h1>
            <p>Esplora la fisica del lancio di un proiettile con e senza resistenza dell'aria</p>
        </div>

        <div class="main-content">
            <!-- Canvas full-width -->
            <div class="canvas-container">
                <canvas id="canvas" width="700" height="500"></canvas>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color legend-color-1"></div>
                        <span class="legend-text">Senza resistenza dell'aria</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color legend-color-2"></div>
                        <span class="legend-text">Con resistenza (F ‚àù v)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color legend-color-3"></div>
                        <span class="legend-text">Modello avanzato (F ‚àù v¬≤)</span>
                    </div>
                </div>
            </div>

            <!-- Bottoni full-width -->
            <div class="button-group margin-top-20">
                <button class="btn-launch" onclick="launch()">Lancia üöÄ</button>
                <button class="btn-reset" onclick="reset()">Reset ‚Ü∫</button>
            </div>

            <!-- Controlli su tre colonne -->
            <div class="controls-grid">
                <!-- Colonna 1: Parametri di Lancio -->
                <div class="controls">
                    <!-- Sezione Parametri di Lancio -->
                    <div class="control-section highlight">
                        <h4>üéØ Parametri di Lancio</h4>
                        <div class="control-group">
                            <label>
                                Velocit√† iniziale (v‚ÇÄ)
                                <span class="value-display" id="velocityValue">25 m/s</span>
                            </label>
                            <input type="range" id="velocity" min="0" max="50" value="25" step="0.5"
                                aria-label="Velocit√† iniziale">
                        </div>

                        <div class="control-group">
                            <label>
                                Angolo di lancio (Œ∏)
                                <span class="value-display" id="angleValue">45¬∞</span>
                            </label>
                            <input type="range" id="angle" min="0" max="90" value="45" step="1"
                                aria-label="Angolo di lancio">
                        </div>
                    </div>
                </div>

                <!-- Colonna 2: Propriet√† Proiettile -->
                <div class="controls">
                    <div class="control-section info">
                        <h4>‚öôÔ∏è Propriet√† Proiettile</h4>
                        <div class="control-group">
                            <label>
                                Massa del proiettile (m)
                                <span class="value-display" id="massValue">1.0 kg</span>
                            </label>
                            <input type="range" id="mass" min="0.1" max="20" value="1.0" step="0.1"
                                aria-label="Massa del proiettile">
                            <p class="helper-text">
                                Esempi: baseball (0.145 kg), palla calcio (0.43 kg), palla bowling (7 kg),
                                proiettile
                                cannone (15 kg)
                            </p>
                        </div>

                        <div class="control-group">
                            <label>
                                Raggio del proiettile (r)
                                <span class="value-display" id="radiusValue">10.0 cm</span>
                            </label>
                            <input type="range" id="radius" min="0.01" max="0.5" value="0.1" step="0.01"
                                aria-label="Raggio del proiettile">
                            <p class="helper-text">
                                Diametro: <strong id="diameterDisplay">20.0 cm</strong><br>
                                Esempi: baseball (3.7 cm), calcio (11 cm), basket (12 cm), palla fitness (35 cm)
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Colonna 3: Resistenza dell'Aria -->
                <div class="controls">
                    <div class="control-section warning">
                        <h4>üí® Modelli di Resistenza dell'Aria</h4>
                        <div class="toggle-container">
                            <span class="toggle-label">Attiva resistenza dell'aria</span>
                            <div class="toggle-switch" id="airResistanceToggle"></div>
                        </div>

                        <div class="control-group" id="dragControl">
                            <label>
                                <span id="dragLabel">Coefficiente di resistenza k (N¬∑s/m)</span>
                                <span class="value-display" id="dragValue">0.1</span>
                            </label>
                            <input type="range" id="drag" min="0" max="0.5" value="0.1" step="0.01"
                                aria-label="Coefficiente di resistenza">
                        </div>

                        <div class="control-group" id="advancedModelContainer">
                            <div>
                                <span class="toggle-label">Modello avanzato (F ‚àù v¬≤)</span>
                                <span>Per alte velocit√† (pi√π realistico)</span>
                            </div>
                            <div class="toggle-switch" id="advancedModelToggle"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Info panel full-width -->
            <div class="info-panel margin-top-20">
                <h3>üìä Dati del lancio</h3>
                <div class="info-item">
                    <span class="info-label">Gittata (senza attrito):</span>
                    <span class="info-value" id="range1">0 m</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Altezza max (senza attrito):</span>
                    <span class="info-value" id="height1">0 m</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Tempo di volo (senza attrito):</span>
                    <span class="info-value" id="time1">0 s</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Velocit√† impatto (senza attrito):</span>
                    <span class="info-value" id="impact1">0 m/s</span>
                </div>
                <hr class="info-divider">
                <div class="info-item">
                    <span class="info-label">Gittata (con attrito F‚àùv):</span>
                    <span class="info-value" id="range2">0 m</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Altezza max (con attrito F‚àùv):</span>
                    <span class="info-value" id="height2">0 m</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Tempo di volo (con attrito F‚àùv):</span>
                    <span class="info-value" id="time2">0 s</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Velocit√† impatto (con attrito F‚àùv):</span>
                    <span class="info-value" id="impact2">0 m/s</span>
                </div>
                <hr class="info-divider">
                <div class="info-item">
                    <span class="info-label">Gittata (modello avanzato F‚àùv¬≤):</span>
                    <span class="info-value" id="range3">0 m</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Altezza max (F‚àùv¬≤):</span>
                    <span class="info-value" id="height3">0 m</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Tempo di volo (F‚àùv¬≤):</span>
                    <span class="info-value" id="time3">0 s</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Velocit√† impatto (F‚àùv¬≤):</span>
                    <span class="info-value" id="impact3">0 m/s</span>
                </div>
                <hr class="info-divider">
                <div class="energy-panel">
                    <h4>‚ö° Energia di Lancio</h4>
                    <div class="info-item">
                        <span class="info-label">Energia cinetica iniziale:</span>
                        <span class="info-value" id="energy">0 J</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Potenza equivalente:</span>
                        <span class="info-value" id="power">0 W</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Area frontale (A = œÄr¬≤):</span>
                        <span class="info-value" id="areaDisplay">0 m¬≤</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Rapporto A/m:</span>
                        <span class="info-value" id="ratioDisplay">0 m¬≤/kg</span>
                    </div>
                    <p class="info-text">
                        <strong>Formula:</strong> E = ¬Ωmv¬≤ <br>
                        <strong>Massa:</strong> <span id="massDisplayInfo">0.145 kg</span> |
                        <strong>Raggio:</strong> <span id="radiusDisplayInfo">5.0 cm</span><br>
                        <em>Un alto rapporto A/m significa pi√π resistenza per unit√† di massa</em>
                    </p>
                </div>
            </div>

            <div class="info-panel didactic-panel margin-top-20">
                <h3>üìö Sezione Didattica</h3>
                <p class="description">Approfondisci la teoria e gli esperimenti dietro la simulazione</p>
                <button class="btn-explain" onclick="openModal()">
                    üìñ Apri Materiale Didattico Completo
                </button>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div id="didacticModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìö Materiale Didattico - Moto Parabolico</h2>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">

                <div class="explanation-box explanation-box-blue">
                    <h4>üßÆ Equazioni del Moto Parabolico</h4>
                    <p><strong>Senza resistenza dell'aria:</strong></p>
                    <ul>
                        <li><strong>Velocit√† iniziali:</strong> v‚ÇÄ‚Çì = v‚ÇÄ¬∑cos(Œ∏), v‚ÇÄ·µß = v‚ÇÄ¬∑sin(Œ∏)</li>
                        <li><strong>Posizione:</strong> x(t) = v‚ÇÄ‚Çì¬∑t, y(t) = v‚ÇÄ·µß¬∑t - ¬Ωg¬∑t¬≤</li>
                        <li><strong>Velocit√†:</strong> v‚Çì(t) = v‚ÇÄ‚Çì, v·µß(t) = v‚ÇÄ·µß - g¬∑t</li>
                        <li><strong>Gittata:</strong> R = v‚ÇÄ¬≤¬∑sin(2Œ∏)/g</li>
                        <li><strong>Altezza max:</strong> h = v‚ÇÄ·µß¬≤/(2g)</li>
                        <li><strong>Tempo volo:</strong> T = 2v‚ÇÄ·µß/g</li>
                    </ul>
                </div>

                <div class="explanation-box explanation-box-orange">
                    <h4>üí® Con Resistenza dell'Aria (Modello
                        Semplificato F ‚àù v)</h4>
                    <p><strong>Forza di resistenza:</strong> F = -k¬∑v (proporzionale
                        alla velocit√†)</p>
                    <p><strong>Accelerazioni:</strong></p>
                    <ul>
                        <li>k_eff = k ¬∑ (A/m) dove A = œÄr¬≤, m = massa</li>
                        <li>a‚Çì = -k_eff¬∑v‚Çì</li>
                        <li>a·µß = -g - k_eff¬∑v·µß</li>
                    </ul>
                    <p class="margin-top"><strong>Metodo numerico (Euler-Cromer):</strong></p>
                    <ul>
                        <li>v‚Çì(t+Œît) = v‚Çì(t) + a‚Çì¬∑Œît</li>
                        <li>v·µß(t+Œît) = v·µß(t) + a·µß¬∑Œît</li>
                        <li>x(t+Œît) = x(t) + v‚Çì(t+Œît)¬∑Œît (usa la nuova velocit√†!)</li>
                        <li>y(t+Œît) = y(t) + v·µß(t+Œît)¬∑Œît (usa la nuova velocit√†!)</li>
                        <li>Passo temporale: Œît = 0.01s</li>
                        <li><strong>Vantaggio:</strong> Euler-Cromer conserva meglio l'energia rispetto a Eulero
                            standard</li>
                    </ul>
                    <p class="margin-top note"><strong>üí° Nota:</strong> Il
                        coefficiente k √® ora moltiplicato per A/m per tenere conto delle dimensioni del
                        proiettile. Oggetti pi√π grandi (A maggiore) o pi√π leggeri (m minore) subiscono pi√π
                        resistenza.</p>
                </div>

                <div class="explanation-box explanation-box-purple">
                    <h4>üöÄ Modello Avanzato (F ‚àù v¬≤)</h4>
                    <p><strong>Forza di resistenza:</strong> F = ¬Ω¬∑œÅ¬∑Cd¬∑A¬∑v¬≤</p>
                    <p><strong>Parametri utilizzati:</strong></p>
                    <ul>
                        <li>œÅ = 1.225 kg/m¬≥ (densit√† aria)</li>
                        <li>Cd = 0.47 (coefficiente resistenza sfera)</li>
                        <li>r = 0.05 m (raggio sfera 5cm)</li>
                        <li>A = œÄr¬≤ = 0.00785 m¬≤ (area frontale)</li>
                        <li>m = 0.145 kg (massa pallina baseball)</li>
                    </ul>
                    <p class="margin-top"><strong>Equazioni:</strong></p>
                    <ul>
                        <li>v = ‚àö(v‚Çì¬≤ + v·µß¬≤)</li>
                        <li>b = (¬Ω¬∑œÅ¬∑Cd¬∑A)/m ‚âà 0.0126</li>
                        <li>a‚Çì = -b¬∑v¬∑v‚Çì/v = -b¬∑v¬∑(v‚Çì/v)</li>
                        <li>a·µß = -g - b¬∑v¬∑(v·µß/v)</li>
                        <li>Passo temporale: Œît = 0.002s</li>
                    </ul>
                    <p class="italic-note"><strong>üí° Questo modello √®
                            pi√π realistico per alte velocit√†!</strong></p>
                </div>

                <div class="explanation-box explanation-box-yellow">
                    <h4>‚ö° Energia di Lancio</h4>
                    <p><strong>Energia cinetica iniziale:</strong></p>
                    <ul>
                        <li>E = ¬Ω¬∑m¬∑v‚ÇÄ¬≤</li>
                        <li>Questa √® l'energia necessaria per portare il proiettile da fermo alla velocit√† v‚ÇÄ
                        </li>
                    </ul>
                    <p class="margin-top"><strong>Potenza media:</strong></p>
                    <ul>
                        <li>P = E / Œît</li>
                        <li>Assumendo accelerazione in Œît = 0.1s (tipico per un lancio manuale)</li>
                        <li>Esempio: per lanciare 0.145 kg a 30 m/s servono ~65 J erogati in ~650 W</li>
                    </ul>
                    <p class="margin-top note"><strong>üí° Nota:</strong> Un
                        essere umano medio pu√≤ generare ~100-300 W in modo sostenuto, ma picchi istantanei molto
                        maggiori (800-1200 W) per brevi periodi.</p>
                </div>

                <div class="explanation-box explanation-box-green">
                    <h4>ü§î Domande Guida per Studenti</h4>
                    <ol>
                        <li><strong>Qual √® l'angolo ottimale?</strong> Lancia a diversi angoli senza resistenza.
                            A quale angolo ottieni la massima gittata? Perch√© proprio 45¬∞?</li>
                        <li><strong>Effetto della resistenza:</strong> Confronta le due traiettorie. Come cambia
                            la forma? Perch√© la discesa √® pi√π ripida?</li>
                        <li><strong>Simmetria:</strong> La traiettoria senza attrito √® simmetrica? E quella con
                            attrito? Perch√©?</li>
                        <li><strong>Energia:</strong> Confronta le velocit√† di impatto. Dove va l'energia
                            "persa" con l'attrito?</li>
                        <li><strong>Tempo di volo:</strong> Come cambia il tempo di volo con la resistenza? √à
                            maggiore o minore?</li>
                        <li><strong>Altezza massima:</strong> L'attrito influisce sull'altezza massima
                            raggiunta? In che modo?</li>
                        <li><strong>Differenza tra modelli:</strong> Attiva il modello avanzato (F ‚àù v¬≤) e
                            confrontalo con quello semplice (F ‚àù v). Quale traiettoria scende pi√π ripidamente?
                            Perch√©?</li>
                        <li><strong>Velocit√† alta vs bassa:</strong> Prova velocit√† di 15 m/s e 45 m/s. In quale
                            caso la differenza tra i due modelli √® pi√π evidente?</li>
                        <li><strong>Effetto della massa:</strong> Mantieni raggio fisso a 5 cm. Varia la massa
                            da 0.05 a 0.5 kg. Come cambia la gittata? Oggetti pi√π pesanti vanno pi√π lontano?
                        </li>
                        <li><strong>Effetto del raggio:</strong> Mantieni massa fissa a 0.145 kg. Varia il
                            raggio da 2 a 10 cm. Come cambia la gittata? Perch√©?</li>
                        <li><strong>Rapporto A/m:</strong> Confronta due oggetti con stesso A/m ma diversa
                            massa. Hanno traiettorie simili? Cosa controlla veramente la resistenza?</li>
                    </ol>
                </div>

                <div class="explanation-box explanation-box-pink">
                    <h4>üî¨ Esperimenti Suggeriti</h4>
                    <div class="content">
                        <p><strong>1. Test dell'angolo ottimale:</strong></p>
                        <p class="experiment-step">‚Ä¢ Disattiva la resistenza<br>‚Ä¢ Prova
                            angoli da 15¬∞ a 75¬∞ (incrementi di 15¬∞)<br>‚Ä¢ Annota le gittate e crea un
                            grafico<br>‚Ä¢ Verifica che 45¬∞ dia la massima gittata</p>

                        <p><strong>2. Effetto della velocit√†:</strong></p>
                        <p class="experiment-step">‚Ä¢ Mantieni angolo a 45¬∞<br>‚Ä¢ Varia
                            velocit√†: 10, 20, 30, 40, 50 m/s<br>‚Ä¢ Osserva come cresce la gittata
                            (quadratico!)<br>‚Ä¢ R ‚àù v¬≤ secondo la formula</p>

                        <p><strong>3. Impatto della resistenza:</strong></p>
                        <p class="experiment-step">‚Ä¢ Fissa v‚ÇÄ = 30 m/s, Œ∏ = 45¬∞<br>‚Ä¢
                            Varia k da 0 a 0.5 (incrementi di 0.1)<br>‚Ä¢ Crea tabella: k vs gittata vs tempo
                            volo<br>‚Ä¢ Osserva la riduzione progressiva</p>

                        <p><strong>4. Confronto asimmetria:</strong></p>
                        <p class="experiment-step">‚Ä¢ Lancia con Œ∏ = 60¬∞ e k = 0.2<br>‚Ä¢
                            Misura distanza salita vs discesa<br>‚Ä¢ Confronta velocit√† iniziale vs finale<br>‚Ä¢
                            Spiega le differenze osservate</p>

                        <p><strong>5. Sfida della gittata fissa:</strong></p>
                        <p class="experiment-step">‚Ä¢ Obiettivo: raggiungere 50m di
                            gittata<br>‚Ä¢ Con k = 0: trova v‚ÇÄ e Œ∏ necessari<br>‚Ä¢ Con k = 0.3: come cambiano i
                            valori?<br>‚Ä¢ Discuti le differenze</p>

                        <p><strong>6. Confronto tra modelli:</strong></p>
                        <p class="experiment-step">‚Ä¢ Imposta v‚ÇÄ = 40 m/s, Œ∏ = 45¬∞, k =
                            0.2<br>‚Ä¢ Attiva resistenza e modello avanzato<br>‚Ä¢ Confronta le 3 traiettorie<br>‚Ä¢
                            Crea una tabella con: gittata, altezza, tempo volo<br>‚Ä¢ Quale modello √® pi√π
                            realistico? Perch√©?</p>

                        <p><strong>7. Effetto velocit√† sui modelli:</strong></p>
                        <p class="experiment-step">‚Ä¢ Prova v‚ÇÄ = 15, 30, 45 m/s (Œ∏ =
                            45¬∞)<br>‚Ä¢ Per ogni velocit√† attiva entrambi i modelli<br>‚Ä¢ Calcola differenza
                            percentuale gittata: (F‚àùv¬≤ vs F‚àùv)<br>‚Ä¢ Osserva: la differenza cresce con la
                            velocit√†!<br>‚Ä¢ Spiega perch√© F ‚àù v¬≤ diventa dominante</p>

                        <p><strong>8. Bilancio energetico:</strong></p>
                        <p class="experiment-step">‚Ä¢ Lancia con v‚ÇÄ = 30 m/s, Œ∏ =
                            45¬∞<br>‚Ä¢ Annota energia iniziale (pannello giallo)<br>‚Ä¢ Calcola energia finale: E_f
                            = ¬Ω¬∑m¬∑v_impatto¬≤<br>‚Ä¢ Energia persa = E_i - E_f<br>‚Ä¢ Dove √® andata questa energia?
                            (calore!)<br>‚Ä¢ Confronta perdita tra i due modelli di resistenza</p>

                        <p><strong>9. Effetto massa e dimensioni:</strong></p>
                        <p class="experiment-step">‚Ä¢ Confronta: pallina ping-pong
                            (m=0.0027 kg, r=2 cm) vs palla calcio (m=0.43 kg, r=11 cm)<br>‚Ä¢ Lancia entrambe a 25
                            m/s, 45¬∞<br>‚Ä¢ Quale subisce pi√π resistenza? Perch√©?<br>‚Ä¢ Calcola e confronta il
                            rapporto A/m<br>‚Ä¢ Un alto A/m significa oggetto "leggero per la sua dimensione"</p>

                        <p><strong>10. Sfida della piuma vs proiettile:</strong></p>
                        <p class="experiment-step">‚Ä¢ Imposta massa piccolissima (0.005
                            kg) e raggio grande (0.1 m)<br>‚Ä¢ Attiva modello avanzato, v‚ÇÄ = 20 m/s<br>‚Ä¢ Osserva
                            la traiettoria: quanto scende velocemente?<br>‚Ä¢ Ora prova massa grande (0.5 kg) e
                            raggio piccolo (0.02 m)<br>‚Ä¢ Confronta le gittate: differenza enorme!<br>‚Ä¢ Spiega
                            usando il rapporto A/m</p>
                    </div>
                </div>

                <div class="explanation-box explanation-box-lightorange">
                    <h4>üí° Note Tecniche</h4>
                    <ul>
                        <li><strong>g = 9.81 m/s¬≤:</strong> accelerazione gravitazionale terrestre</li>
                        <li><strong>Metodo di Euler-Cromer:</strong> integrazione numerica semi-implicita per
                            equazioni differenziali. A differenza del metodo di Eulero standard, Euler-Cromer
                            aggiorna prima le velocit√† e poi usa le nuove velocit√† per aggiornare le posizioni.
                            Questo lo rende pi√π stabile e conservativo dell'energia, particolarmente importante
                            per simulazioni fisiche.
                        </li>
                        <li><strong>Coefficiente k (modello semplice):</strong> rappresenta resistenza
                            "generica", poi moltiplicato per A/m</li>
                        <li><strong>Coefficiente di resistenza Cd = 0.47:</strong> valore tipico per sfere lisce
                        </li>
                        <li><strong>Rapporto A/m critico:</strong> determina quanto un oggetto √® sensibile alla
                            resistenza dell'aria
                            <ul>
                                <li>Ping-pong: A/m ‚âà 0.47 m¬≤/kg (molto alto, cade lentamente)</li>
                                <li>Baseball: A/m ‚âà 0.054 m¬≤/kg (medio)</li>
                                <li>Proiettile denso: A/m ‚âà 0.003 m¬≤/kg (basso, penetra l'aria)</li>
                            </ul>
                        </li>
                        <li><strong>Limite del modello:</strong> In questa simulazione usiamo F = -k¬∑v (modello
                            semplice) e F = ¬Ω¬∑œÅ¬∑Cd¬∑A¬∑v¬≤ (modello avanzato). Nella realt√†, per velocit√† elevate
                            (v > 50 m/s), il modello quadratico √® pi√π accurato. Usiamo il modello lineare per
                            didattica perch√© √® pi√π semplice da capire e mostra comunque gli effetti principali
                            dell'attrito.</li>
                        <li><strong>Scala grafico:</strong> 1 divisione griglia = 10 metri</li>
                    </ul>

                    <div class="explanation-box-lightblue">
                        <p><strong>‚öñÔ∏è Quando usare quale modello?</strong>
                        </p>
                        <ul>
                            <li><strong>F ‚àù v</strong> (modello semplice): oggetti lenti, piccoli, basse
                                velocit√† (es: pallina da tennis, frisbee, foglia che cade)</li>
                            <li><strong>F ‚àù v¬≤</strong> (modello avanzato): oggetti veloci, grandi, alte
                                velocit√† (es: proiettili, auto, aerei, meteoriti, palloni da calcio)</li>
                            <li><strong>Differenza pratica:</strong> Con F ‚àù v¬≤ la discesa √® ancora pi√π ripida e
                                la velocit√† finale molto pi√π bassa rispetto al modello lineare. L'effetto √® pi√π
                                pronunciato per oggetti con alto rapporto A/m.</li>
                        </ul>
                    </div>
                </div>

            </div>
        </div>
    </div>
    </div>

    <script>
        function openModal() {
            document.getElementById('didacticModal').classList.add('show');
            document.body.style.overflow = 'hidden'; // Previene lo scroll della pagina
        }

        function closeModal() {
            document.getElementById('didacticModal').classList.remove('show');
            document.body.style.overflow = 'auto'; // Ripristina lo scroll della pagina
        }

        // Chiudi il modale cliccando fuori dal contenuto
        window.onclick = function (event) {
            const modal = document.getElementById('didacticModal');
            if (event.target === modal) {
                closeModal();
            }
        }

        // Chiudi il modale con il tasto ESC
        document.addEventListener('keydown', function (event) {
            if (event.key === 'Escape') {
                closeModal();
            }
        });
    </script>

    <script>
        /*
         * SIMULATORE MOTO PARABOLICO CON RESISTENZA DELL'ARIA
         * 
         * FORMULE FISICHE UTILIZZATE:
         * 
         * 1. COSTANTI:
         *    g = 9.81 m/s¬≤ (accelerazione di gravit√†)
         * 
         * 2. MOTO PARABOLICO SENZA RESISTENZA DELL'ARIA:
         *    - Componenti velocit√† iniziale:
         *      v‚ÇÄ‚Çì = v‚ÇÄ ¬∑ cos(Œ∏)
         *      v‚ÇÄ·µß = v‚ÇÄ ¬∑ sin(Œ∏)
         *    
         *    - Equazioni del moto:
         *      x(t) = v‚ÇÄ‚Çì ¬∑ t
         *      y(t) = v‚ÇÄ·µß ¬∑ t - (1/2) ¬∑ g ¬∑ t¬≤
         *      v‚Çì(t) = v‚ÇÄ‚Çì (costante)
         *      v·µß(t) = v‚ÇÄ·µß - g ¬∑ t
         *    
         *    - Altezza massima:
         *      h_max = (v‚ÇÄ·µß)¬≤ / (2g)
         *    
         *    - Tempo di volo:
         *      t_volo = 2 ¬∑ v‚ÇÄ·µß / g
         *    
         *    - Gittata:
         *      R = v‚ÇÄ¬≤ ¬∑ sin(2Œ∏) / g
         * 
         * 3. MOTO CON RESISTENZA DELL'ARIA (MODELLO SEMPLIFICATO):
         *    - Forza di resistenza proporzionale alla velocit√†:
         *      F_drag = -k ¬∑ v (dove k √® il coefficiente di resistenza base)
         *    
         *    - Per tenere conto delle dimensioni del proiettile:
         *      k_eff = k ¬∑ (A/m) dove A = œÄ¬∑r¬≤ (area frontale) e m = massa
         *      Oggetti con alto rapporto A/m subiscono pi√π resistenza
         *    
         *    - Equazioni differenziali (metodo di Eulero):
         *      a‚Çì = -k_eff ¬∑ v‚Çì
         *      a·µß = -g - k_eff ¬∑ v·µß
         *      
         *      v‚Çì(t + Œît) = v‚Çì(t) + a‚Çì ¬∑ Œît
         *      v·µß(t + Œît) = v·µß(t) + a·µß ¬∑ Œît
         *      
         *      x(t + Œît) = x(t) + v‚Çì ¬∑ Œît
         *      y(t + Œît) = y(t) + v·µß ¬∑ Œît
         * 
         *    - Integrazione numerica con passo temporale Œît = 0.01s
         * 
         * 4. MOTO CON RESISTENZA DELL'ARIA (MODELLO AVANZATO):
         *    - Forza di resistenza proporzionale al quadrato della velocit√†:
         *      F_drag = ¬Ω ¬∑ œÅ ¬∑ Cd ¬∑ A ¬∑ v¬≤
         *      dove:
         *      œÅ = 1.225 kg/m¬≥ (densit√† dell'aria al livello del mare, 15¬∞C)
         *      Cd = 0.47 (coefficiente di resistenza aerodinamica per sfera)
         *      A = œÄ¬∑r¬≤ (area frontale, dipende dal raggio r configurabile)
         *      m = massa configurabile del proiettile
         *    
         *    - Coefficiente combinato per semplificazione:
         *      b = (¬Ω¬∑œÅ¬∑Cd¬∑A)/m [s‚Åª¬π]
         *      b dipende sia dal raggio (‚Üër ‚Üí ‚ÜëA ‚Üí ‚Üëb ‚Üí pi√π resistenza)
         *          sia dalla massa (‚Üëm ‚Üí ‚Üìb ‚Üí meno resistenza per unit√† di massa)
         *    
         *    - Equazioni differenziali (metodo di Euler-Cromer):
         *      v = ‚àö(v‚Çì¬≤ + v·µß¬≤) (modulo velocit√†)
         *      
         *      a‚Çì = -b¬∑v¬∑(v‚Çì/v) = -b¬∑v¬∑v‚Çì/v (resistenza opposta a v‚Çì)
         *      a·µß = -g - b¬∑v¬∑(v·µß/v) = -g - b¬∑v¬∑v·µß/v (gravit√† + resistenza opposta a v·µß)
         *      
         *      v‚Çì(t + Œît) = v‚Çì(t) + a‚Çì ¬∑ Œît
         *      v·µß(t + Œît) = v·µß(t) + a·µß ¬∑ Œît
         *      
         *      x(t + Œît) = x(t) + v‚Çì(t + Œît) ¬∑ Œît  (usa la nuova velocit√†!)
         *      y(t + Œît) = y(t) + v·µß(t + Œît) ¬∑ Œît  (usa la nuova velocit√†!)
         * 
         *    - Integrazione numerica con passo temporale Œît = 0.002s (pi√π piccolo per accuratezza)
         *    - Questo modello √® pi√π realistico per alte velocit√† (v > 10 m/s)
         *    
         * 5. ENERGIA DI LANCIO:
         *    - Energia cinetica iniziale: E = ¬Ω¬∑m¬∑v‚ÇÄ¬≤
         *    - Potenza media: P = E/Œît (assumendo Œît = 0.1s per accelerazione)
         *    - L'energia persa per attrito si trasforma in calore
         *    - Rapporto A/m indica quanto un oggetto √® "aerodinamicamente sensibile"
         */

        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const g = 9.81; // m/s¬≤ - accelerazione di gravit√†

        let velocity = 25;
        let angle = 45;
        let dragCoeff = 0.1;
        let airResistanceEnabled = false;
        let advancedModelEnabled = false;
        let animationId = null;

        // Parametri configurabili per massa e dimensioni
        let projectileMass = 1.0; // kg (default 1 kg)
        let projectileRadius = 0.1; // metri (10 cm)

        // Scala di visualizzazione (pixel per metro)
        const scale = 5;
        const originX = 50;
        const originY = canvas.height - 80;

        // Parametri per modello avanzato (F ‚àù v¬≤)
        const rho = 1.225; // densit√† aria kg/m¬≥
        const Cd = 0.47;   // coefficiente di resistenza per sfera

        // Funzione per calcolare parametri dipendenti da massa e raggio
        function calculateDragParameters() {
            const A = Math.PI * projectileRadius * projectileRadius; // area frontale œÄr¬≤
            const b = 0.5 * rho * Cd * A / projectileMass; // coefficiente combinato
            return { A, b };
        }

        // Aggiornamento valori display
        document.getElementById('velocity').addEventListener('input', (e) => {
            velocity = parseFloat(e.target.value);
            document.getElementById('velocityValue').textContent = velocity + ' m/s';
        });

        document.getElementById('angle').addEventListener('input', (e) => {
            angle = parseFloat(e.target.value);
            document.getElementById('angleValue').textContent = angle + '¬∞';
        });

        document.getElementById('drag').addEventListener('input', (e) => {
            dragCoeff = parseFloat(e.target.value);
            document.getElementById('dragValue').textContent = dragCoeff;
        });

        document.getElementById('mass').addEventListener('input', (e) => {
            projectileMass = parseFloat(e.target.value);
            document.getElementById('massValue').textContent = projectileMass.toFixed(3) + ' kg';
        });

        document.getElementById('radius').addEventListener('input', (e) => {
            projectileRadius = parseFloat(e.target.value);
            document.getElementById('radiusValue').textContent = (projectileRadius * 100).toFixed(1) + ' cm';
            const diameter = projectileRadius * 2 * 100;
            document.getElementById('diameterDisplay').textContent = diameter.toFixed(1) + ' cm';
        });

        // Toggle resistenza dell'aria
        document.getElementById('airResistanceToggle').addEventListener('click', function () {
            airResistanceEnabled = !airResistanceEnabled;
            this.classList.toggle('active');
            document.getElementById('dragControl').style.opacity = airResistanceEnabled ? '1' : '0.5';
            document.getElementById('advancedModelContainer').style.opacity = airResistanceEnabled ? '1' : '0.5';
        });

        // Toggle modello avanzato
        document.getElementById('advancedModelToggle').addEventListener('click', function () {
            if (airResistanceEnabled) {
                advancedModelEnabled = !advancedModelEnabled;
                this.classList.toggle('active');
                updateDragLabel();
            }
        });

        // Funzione per aggiornare la label del coefficiente di resistenza
        function updateDragLabel() {
            const dragLabel = document.getElementById('dragLabel');
            if (advancedModelEnabled) {
                dragLabel.textContent = 'Coefficiente di resistenza Cd (adimensionale)';
            } else {
                dragLabel.textContent = 'Coefficiente di resistenza k (N¬∑s/m)';
            }
        }

        function drawBackground() {
            // Cielo
            const gradient = ctx.createLinearGradient(0, 0, 0, originY);
            gradient.addColorStop(0, '#87CEEB');
            gradient.addColorStop(1, '#E0F6FF');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, originY);

            // Terreno
            ctx.fillStyle = '#8B7355';
            ctx.fillRect(0, originY, canvas.width, canvas.height - originY);

            // Erba
            ctx.fillStyle = '#90EE90';
            ctx.fillRect(0, originY - 5, canvas.width, 5);

            // Griglia
            ctx.strokeStyle = '#ddd';
            ctx.lineWidth = 1;
            for (let i = 0; i < canvas.width; i += scale * 10) {
                ctx.beginPath();
                ctx.moveTo(i, 0);
                ctx.lineTo(i, originY);
                ctx.stroke();
            }
            for (let i = 0; i < originY; i += scale * 10) {
                ctx.beginPath();
                ctx.moveTo(0, originY - i);
                ctx.lineTo(canvas.width, originY - i);
                ctx.stroke();
            }

            // Scala metrica asse orizzontale (X)
            ctx.fillStyle = '#333';
            ctx.font = 'bold 11px Arial';
            ctx.textAlign = 'center';
            for (let i = 0; i <= canvas.width - originX; i += scale * 10) {
                const meters = i / scale;
                const x = originX + i;
                if (x < canvas.width - 10) {
                    // Tacchetta
                    ctx.strokeStyle = '#333';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.moveTo(x, originY - 3);
                    ctx.lineTo(x, originY + 8);
                    ctx.stroke();
                    // Numero
                    ctx.fillText(meters + 'm', x, originY + 20);
                }
            }

            // Scala metrica asse verticale (Y)
            ctx.textAlign = 'right';
            for (let i = scale * 10; i < originY; i += scale * 10) {
                const meters = i / scale;
                const y = originY - i;
                if (y > 20) {
                    // Tacchetta
                    ctx.strokeStyle = '#333';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.moveTo(originX - 8, y);
                    ctx.lineTo(originX + 3, y);
                    ctx.stroke();
                    // Numero
                    ctx.fillText(meters + 'm', originX - 12, y + 4);
                }
            }

            // Assi cartesiani
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            // Asse X
            ctx.beginPath();
            ctx.moveTo(originX, originY);
            ctx.lineTo(canvas.width, originY);
            ctx.stroke();
            // Asse Y
            ctx.beginPath();
            ctx.moveTo(originX, originY);
            ctx.lineTo(originX, 0);
            ctx.stroke();

            // Etichette assi
            ctx.fillStyle = '#333';
            ctx.font = 'bold 12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Distanza orizzontale (x)', canvas.width / 2 + 20, originY + 35);
            ctx.save();
            ctx.translate(15, canvas.height / 2 - 50);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('Altezza (y)', 0, 0);
            ctx.restore();

            // Cannone
            ctx.save();
            ctx.translate(originX, originY);
            ctx.rotate(-angle * Math.PI / 180);
            ctx.fillStyle = '#333';
            ctx.fillRect(0, -5, 30, 10);
            ctx.restore();

            // Base cannone
            ctx.fillStyle = '#555';
            ctx.beginPath();
            ctx.arc(originX, originY, 15, 0, Math.PI * 2);
            ctx.fill();
        }

        function calculateTrajectoryNoAir() {
            const angleRad = angle * Math.PI / 180;
            const v0x = velocity * Math.cos(angleRad);
            const v0y = velocity * Math.sin(angleRad);

            // Tempo di volo: t = 2¬∑v‚ÇÄ·µß / g
            const flightTime = 2 * v0y / g;

            // Gittata: R = v‚ÇÄ¬≤ ¬∑ sin(2Œ∏) / g
            const range = (velocity * velocity * Math.sin(2 * angleRad)) / g;

            // Altezza massima: h = v‚ÇÄ·µß¬≤ / (2g)
            const maxHeight = (v0y * v0y) / (2 * g);

            // Velocit√† di impatto (uguale a v‚ÇÄ in assenza di attrito)
            const impactVelocity = velocity;

            const trajectory = [];
            const dt = 0.02;

            for (let t = 0; t <= flightTime; t += dt) {
                // x(t) = v‚ÇÄ‚Çì ¬∑ t
                const x = v0x * t;
                // y(t) = v‚ÇÄ·µß ¬∑ t - (1/2) ¬∑ g ¬∑ t¬≤
                const y = v0y * t - 0.5 * g * t * t;

                if (y >= 0) {
                    trajectory.push({ x, y, t });
                }
            }

            return { trajectory, range, maxHeight, flightTime, impactVelocity };
        }

        function calculateTrajectoryWithAir() {
            const angleRad = angle * Math.PI / 180;
            let vx = velocity * Math.cos(angleRad);
            let vy = velocity * Math.sin(angleRad);
            let x = 0;
            let y = 0;
            let t = 0;

            const trajectory = [];
            const dt = 0.01; // Passo temporale ridotto per maggiore precisione
            let maxHeight = 0;

            // Il coefficiente k nel modello semplificato tiene conto implicitamente di forma e dimensioni
            // Per rendere il modello pi√π realistico, k dovrebbe dipendere da A/m
            // Usiamo: k_effective = dragCoeff * (A/m) dove A = œÄr¬≤
            const area = Math.PI * projectileRadius * projectileRadius;
            const k_effective = dragCoeff * (area / projectileMass);

            while (y >= 0 && t < 100) {
                trajectory.push({ x, y, t });

                if (y > maxHeight) {
                    maxHeight = y;
                }

                // Accelerazioni con resistenza dell'aria: a = -k¬∑v
                const ax = -k_effective * vx;
                const ay = -g - k_effective * vy;

                // Integrazione di Euler-Cromer (semi-implicito)
                // 1. Aggiorna velocit√†
                vx += ax * dt;
                vy += ay * dt;
                // 2. Usa la nuova velocit√† per aggiornare posizione
                x += vx * dt;
                y += vy * dt;
                t += dt;

                // Sicurezza per evitare loop infiniti
                if (x > 2000 || y < -10) break;
            }

            const range = x;
            const flightTime = t;
            const impactVelocity = Math.sqrt(vx * vx + vy * vy);

            return { trajectory, range, maxHeight, flightTime, impactVelocity };
        }

        function calculateTrajectoryAdvanced() {
            const angleRad = angle * Math.PI / 180;
            let vx = velocity * Math.cos(angleRad);
            let vy = velocity * Math.sin(angleRad);
            let x = 0;
            let y = 0;
            let t = 0;

            const trajectory = [];
            const dt = 0.002; // Passo temporale molto piccolo per maggiore accuratezza
            let maxHeight = 0;

            // Calcola parametri che dipendono da massa e raggio
            const { b } = calculateDragParameters();

            while (y >= 0 && t < 100) {
                trajectory.push({ x, y, t });

                if (y > maxHeight) {
                    maxHeight = y;
                }

                // Calcolo velocit√† totale
                const v = Math.sqrt(vx * vx + vy * vy);

                // Componenti accelerazione per F = (1/2) * œÅ * Cd * A * v¬≤
                // a = -(b * v) * v_hat dove b = (1/2) * œÅ * Cd * A / m
                let ax = 0;
                let ay = -g;

                if (v > 0.0001) { // Evita divisione per zero
                    // Direzione del vettore velocit√† normalizzato
                    const vx_norm = vx / v;
                    const vy_norm = vy / v;

                    // Accelerazione dovuta alla resistenza (opposta alla velocit√†)
                    ax = -b * v * vx_norm;
                    ay = -g - b * v * vy_norm;
                }

                // Integrazione di Euler-Cromer (semi-implicito)
                // 1. Aggiorna velocit√†
                vx += ax * dt;
                vy += ay * dt;
                // 2. Usa la nuova velocit√† per aggiornare posizione
                x += vx * dt;
                y += vy * dt;
                t += dt;

                // Sicurezza: se la velocit√† diventa troppo piccola o coordinate non valide
                if (x > 2000 || y < -10) break;
            }

            const range = x;
            const flightTime = t;
            const impactVelocity = Math.sqrt(vx * vx + vy * vy);

            return { trajectory, range, maxHeight, flightTime, impactVelocity };
        }

        function drawTrajectory(trajectory, color, showMarkers, verticalOffset = 0) {
            if (trajectory.length === 0) return;

            ctx.strokeStyle = color;
            ctx.lineWidth = 3;
            ctx.beginPath();

            for (let i = 0; i < trajectory.length; i++) {
                const point = trajectory[i];
                const screenX = originX + point.x * scale;
                const screenY = originY - point.y * scale;

                if (i === 0) {
                    ctx.moveTo(screenX, screenY);
                } else {
                    ctx.lineTo(screenX, screenY);
                }
            }
            ctx.stroke();

            if (showMarkers) {
                // Trova altezza massima
                let maxHeightPoint = trajectory[0];
                for (let point of trajectory) {
                    if (point.y > maxHeightPoint.y) {
                        maxHeightPoint = point;
                    }
                }

                // Marker altezza massima
                const maxHeightX = originX + maxHeightPoint.x * scale;
                const maxHeightY = originY - maxHeightPoint.y * scale;

                // Linea tratteggiata verticale per altezza
                ctx.strokeStyle = color;
                ctx.setLineDash([5, 5]);
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(maxHeightX, maxHeightY);
                ctx.lineTo(maxHeightX, originY);
                ctx.stroke();
                ctx.setLineDash([]);

                // Punto all'altezza massima
                ctx.fillStyle = color;
                ctx.beginPath();
                ctx.arc(maxHeightX, maxHeightY, 6, 0, Math.PI * 2);
                ctx.fill();

                // Label H_max con offset verticale per evitare sovrapposizioni
                ctx.fillStyle = '#fff';
                ctx.strokeStyle = color;
                ctx.lineWidth = 2;
                ctx.font = 'bold 12px Arial';
                ctx.textAlign = 'center';
                const hText = 'H_max: ' + maxHeightPoint.y.toFixed(1) + 'm';
                const hTextWidth = ctx.measureText(hText).width;
                const hLabelY = maxHeightY - 25 - verticalOffset * 20;
                ctx.fillStyle = color;
                ctx.fillRect(maxHeightX - hTextWidth / 2 - 4, hLabelY, hTextWidth + 8, 18);
                ctx.fillStyle = '#fff';
                ctx.fillText(hText, maxHeightX, hLabelY + 13);

                // Marker gittata
                const landingPoint = trajectory[trajectory.length - 1];
                const landingX = originX + landingPoint.x * scale;

                // Linea verticale per gittata
                ctx.strokeStyle = color;
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(landingX, originY - 15);
                ctx.lineTo(landingX, originY + 15);
                ctx.stroke();

                // Label R_max con offset verticale per evitare sovrapposizioni
                ctx.font = 'bold 12px Arial';
                ctx.textAlign = 'center';
                const rText = 'R_max: ' + landingPoint.x.toFixed(1) + 'm';
                const rTextWidth = ctx.measureText(rText).width;
                const rLabelY = originY + 20 + verticalOffset * 20;
                ctx.fillStyle = color;
                ctx.fillRect(landingX - rTextWidth / 2 - 4, rLabelY, rTextWidth + 8, 18);
                ctx.fillStyle = '#fff';
                ctx.fillText(rText, landingX, rLabelY + 13);
            }
        }

        function updateDisplay(data1, data2, data3) {
            document.getElementById('range1').textContent = data1.range.toFixed(2) + ' m';
            document.getElementById('height1').textContent = data1.maxHeight.toFixed(2) + ' m';
            document.getElementById('time1').textContent = data1.flightTime.toFixed(2) + ' s';
            document.getElementById('impact1').textContent = data1.impactVelocity.toFixed(2) + ' m/s';

            // Calcola energia cinetica: E = (1/2) * m * v¬≤
            const kineticEnergy = 0.5 * projectileMass * velocity * velocity;
            document.getElementById('energy').textContent = kineticEnergy.toFixed(2) + ' J';

            // Potenza media (assumendo accelerazione istantanea in 0.1 secondi)
            const accelerationTime = 0.1; // tempo tipico di accelerazione in secondi
            const power = kineticEnergy / accelerationTime;
            document.getElementById('power').textContent = power.toFixed(1) + ' W';

            // Calcola area e rapporto A/m
            const area = Math.PI * projectileRadius * projectileRadius;
            const ratio = area / projectileMass;
            document.getElementById('areaDisplay').textContent = area.toFixed(6) + ' m¬≤';
            document.getElementById('ratioDisplay').textContent = ratio.toFixed(4) + ' m¬≤/kg';

            document.getElementById('massDisplayInfo').textContent = projectileMass.toFixed(3) + ' kg';
            document.getElementById('radiusDisplayInfo').textContent = (projectileRadius * 100).toFixed(1) + ' cm';

            // Mostra i dati con attrito solo se la resistenza √® attiva
            if (airResistanceEnabled) {
                document.getElementById('range2').textContent = data2.range.toFixed(2) + ' m';
                document.getElementById('height2').textContent = data2.maxHeight.toFixed(2) + ' m';
                document.getElementById('time2').textContent = data2.flightTime.toFixed(2) + ' s';
                document.getElementById('impact2').textContent = data2.impactVelocity.toFixed(2) + ' m/s';
            } else {
                document.getElementById('range2').textContent = '-';
                document.getElementById('height2').textContent = '-';
                document.getElementById('time2').textContent = '-';
                document.getElementById('impact2').textContent = '-';
            }

            // Mostra i dati modello avanzato solo se attivato
            if (airResistanceEnabled && advancedModelEnabled) {
                document.getElementById('range3').textContent = data3.range.toFixed(2) + ' m';
                document.getElementById('height3').textContent = data3.maxHeight.toFixed(2) + ' m';
                document.getElementById('time3').textContent = data3.flightTime.toFixed(2) + ' s';
                document.getElementById('impact3').textContent = data3.impactVelocity.toFixed(2) + ' m/s';
            } else {
                document.getElementById('range3').textContent = '-';
                document.getElementById('height3').textContent = '-';
                document.getElementById('time3').textContent = '-';
                document.getElementById('impact3').textContent = '-';
            }
        }

        function launch() {
            reset();

            const data1 = calculateTrajectoryNoAir();
            const data2 = calculateTrajectoryWithAir();
            const data3 = calculateTrajectoryAdvanced();

            let index1 = 0;
            let index2 = 0;
            let index3 = 0;

            function animate() {
                drawBackground();

                // Disegna traiettoria senza aria (sempre visibile)
                if (index1 < data1.trajectory.length) {
                    drawTrajectory(data1.trajectory.slice(0, index1 + 1), '#FF6B35', false, 0);
                    index1 += 2;
                } else {
                    // Disegna sempre i marker per la traiettoria senza attrito
                    drawTrajectory(data1.trajectory, '#FF6B35', true, 0);
                }

                // Disegna traiettoria con aria (solo se resistenza attiva)
                if (airResistanceEnabled) {
                    if (index2 < data2.trajectory.length) {
                        drawTrajectory(data2.trajectory.slice(0, index2 + 1), '#004E89', false, 1);
                        index2 += 2;
                    } else {
                        drawTrajectory(data2.trajectory, '#004E89', true, 1);
                    }
                }

                // Disegna traiettoria modello avanzato (solo se attivato)
                if (airResistanceEnabled && advancedModelEnabled) {
                    if (index3 < data3.trajectory.length) {
                        drawTrajectory(data3.trajectory.slice(0, index3 + 1), '#9D4EDD', false, 2);
                        index3 += 2;
                    } else {
                        drawTrajectory(data3.trajectory, '#9D4EDD', true, 2);
                    }
                }

                // Disegna proiettile senza aria (sempre visibile)
                if (index1 < data1.trajectory.length) {
                    const point1 = data1.trajectory[Math.min(index1, data1.trajectory.length - 1)];
                    ctx.fillStyle = '#FF6B35';
                    ctx.beginPath();
                    ctx.arc(originX + point1.x * scale, originY - point1.y * scale, 8, 0, Math.PI * 2);
                    ctx.fill();
                }

                // Disegna proiettile con aria (solo se resistenza attiva)
                if (airResistanceEnabled && index2 < data2.trajectory.length) {
                    const point2 = data2.trajectory[Math.min(index2, data2.trajectory.length - 1)];
                    ctx.fillStyle = '#004E89';
                    ctx.beginPath();
                    ctx.arc(originX + point2.x * scale, originY - point2.y * scale, 8, 0, Math.PI * 2);
                    ctx.fill();
                }

                // Disegna proiettile modello avanzato (solo se attivato)
                if (airResistanceEnabled && advancedModelEnabled && index3 < data3.trajectory.length) {
                    const point3 = data3.trajectory[Math.min(index3, data3.trajectory.length - 1)];
                    ctx.fillStyle = '#9D4EDD';
                    ctx.beginPath();
                    ctx.arc(originX + point3.x * scale, originY - point3.y * scale, 8, 0, Math.PI * 2);
                    ctx.fill();
                }

                if (index1 < data1.trajectory.length ||
                    (airResistanceEnabled && index2 < data2.trajectory.length) ||
                    (airResistanceEnabled && advancedModelEnabled && index3 < data3.trajectory.length)) {
                    animationId = requestAnimationFrame(animate);
                } else {
                    // Disegna un ultimo frame per assicurarsi che i marker siano visibili
                    drawBackground();
                    drawTrajectory(data1.trajectory, '#FF6B35', true, 0);
                    if (airResistanceEnabled) {
                        drawTrajectory(data2.trajectory, '#004E89', true, 1);
                    }
                    if (airResistanceEnabled && advancedModelEnabled) {
                        drawTrajectory(data3.trajectory, '#9D4EDD', true, 2);
                    }
                }
            }

            updateDisplay(data1, data2, data3);
            animate();
        }

        function reset() {
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
            drawBackground();
        }

        // Inizializzazione
        drawBackground();
    </script>
</body>

</html>